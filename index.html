<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PagFesta</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #fffaf0;
      color: #333;
    }
    header {
      background-color: #d62828;
      color: white;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .container {
      max-width: 600px;
      margin: 0 auto;
      padding: 20px;
    }
    h2 { color: #d62828; }
    .produto { margin: 10px 0; display: flex; justify-content: space-between; align-items: center; }
    .quantidade-controls {
      display: flex;
      align-items: center;
    }
    .quantidade-controls button {
      padding: 5px 10px;
      margin: 0 5px;
      background-color: #d62828;
      color: white;
      border: none;
      border-radius: 5px;
    }
    .quantidade-controls input {
      width: 40px;
      text-align: center;
    }
    .btn {
      background: #d62828;
      color: white;
      border: none;
      padding: 10px 20px;
      cursor: pointer;
      border-radius: 5px;
      margin-top: 20px;
    }
    .btn:hover { background: #b71c1c; }
    .resumo, .pagamento, .qrcode { display: none; }
    .total { font-weight: bold; margin-top: 10px; }
    .qrcode canvas {
      display: block;
      margin: 20px auto;
      width: 250px !important;
      height: 250px !important;
    }
    .pedido-numero {
      text-align: center;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <div>
      <h1>PagFesta</h1>
      <p>Quermesse Nossa Senhora da Boa Esperança</p>
    </div>
    <button class="btn" onclick="window.location.href='painel.html'">Administrador</button>
  </header>

  <div class="container">
    <section class="pedido">
      <h2>Escolha seus produtos</h2>
      <form id="formulario"></form>
      <button class="btn" onclick="avancarPedido()">Avançar</button>
    </section>

    <section class="resumo">
      <h2>Resumo do Pedido</h2>
      <ul id="lista-resumo"></ul>
      <p class="total" id="valor-total"></p>
      <button class="btn" onclick="mostrarPagamento()">Ir para pagamento</button>
      <button class="btn" onclick="voltarAoPedido()">Voltar</button>
    </section>

    <section class="pagamento">
      <h2>Forma de Pagamento</h2>
      <label><input type="radio" name="pagamento" value="Pix" checked /> Pix</label>
      <label><input type="radio" name="pagamento" value="Cartão" /> Cartão</label>
      <label><input type="radio" name="pagamento" value="Dinheiro" /> Dinheiro na retirada</label>
      <br>
      <button class="btn" onclick="gerarQRCode()">Confirmar Pagamento</button>
      <button class="btn" onclick="voltarResumo()">Voltar</button>
    </section>

    <section class="qrcode">
      <h2>Seu QR Code</h2>
      <canvas id="qr"></canvas>
      <p class="pedido-numero" id="numero-pedido"></p>
      <button class="btn" onclick="novoPedido()">Gerar novo pedido</button>
    </section>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "SUA_API_KEY",
      authDomain: "SEU_DOMINIO.firebaseapp.com",
      databaseURL: "https://SEU_DOMINIO.firebaseio.com",
      projectId: "SEU_ID",
      storageBucket: "SEU_BUCKET",
      messagingSenderId: "SEU_SENDER_ID",
      appId: "SEU_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const produtos = [
      { id: 'pastel', nome: 'Pastel', preco: 10 },
      { id: 'hotdog', nome: 'HotDog', preco: 10 },
      { id: 'doces', nome: 'Doces', preco: 6 },
      { id: 'caldinho', nome: 'Caldinho', preco: 10 },
      { id: 'refri', nome: 'Refrigerante', preco: 6 },
      { id: 'espeto', nome: 'Espeto de Frango', preco: 12 },
      { id: 'suco', nome: 'Suco', preco: 5 },
      { id: 'agua', nome: 'Água', preco: 3 }
    ];

    const form = document.getElementById('formulario');
    const listaResumo = document.getElementById('lista-resumo');
    const valorTotal = document.getElementById('valor-total');
    let pedidoFinal = [];
    let total = 0;
    let numeroPedido = 1;

    function carregarProdutos() {
      form.innerHTML = '';
      produtos.forEach(prod => {
        form.innerHTML += `
          <div class="produto">
            <label>${prod.nome} - R$${prod.preco.toFixed(2)}</label>
            <div class="quantidade-controls">
              <button type="button" onclick="alterarQuantidade('${prod.id}', -1)">-</button>
              <input type="number" id="${prod.id}" value="0" min="0" readonly />
              <button type="button" onclick="alterarQuantidade('${prod.id}', 1)">+</button>
            </div>
          </div>`;
      });
    }

    function alterarQuantidade(id, delta) {
      const input = document.getElementById(id);
      const novaQuantidade = Math.max(0, parseInt(input.value) + delta);
      input.value = novaQuantidade;
    }

    function avancarPedido() {
      pedidoFinal = [];
      total = 0;
      listaResumo.innerHTML = '';
      produtos.forEach(prod => {
        const qtd = parseInt(document.getElementById(prod.id).value);
        if (qtd > 0) {
          const subtotal = prod.preco * qtd;
          pedidoFinal.push({ nome: prod.nome, qtd, preco: prod.preco });
          total += subtotal;
          listaResumo.innerHTML += `<li>${prod.nome} x ${qtd} - R$${subtotal.toFixed(2)}</li>`;
        }
      });

      if (pedidoFinal.length === 0) {
        alert('Selecione ao menos um produto.');
        return;
      }

      valorTotal.textContent = `Total: R$${total.toFixed(2)}`;
      document.querySelector('.pedido').style.display = 'none';
      document.querySelector('.resumo').style.display = 'block';
    }

    function mostrarPagamento() {
      document.querySelector('.resumo').style.display = 'none';
      document.querySelector('.pagamento').style.display = 'block';
    }

    function voltarAoPedido() {
      document.querySelector('.resumo').style.display = 'none';
      document.querySelector('.pedido').style.display = 'block';
    }

    function voltarResumo() {
      document.querySelector('.pagamento').style.display = 'none';
      document.querySelector('.resumo').style.display = 'block';
    }

    function gerarQRCode() {
      const formaPagamento = document.querySelector('input[name="pagamento"]:checked').value;
      db.ref('pedidos').once('value', snapshot => {
        const pedidos = snapshot.val();
        numeroPedido = pedidos ? Object.keys(pedidos).length + 1 : 1;
        const texto = `Pedido ${numeroPedido}\n` + pedidoFinal.map(p => `${p.nome} x ${p.qtd}`).join(', ') + `\nTotal: R$${total.toFixed(2)}\nPagamento: ${formaPagamento}`;
        QRCode.toCanvas(document.getElementById('qr'), texto, error => {
          if (error) console.error(error);
        });
        document.getElementById('numero-pedido').textContent = `Pedido #${numeroPedido}`;
        db.ref('pedidos/' + numeroPedido).set({ pedido: pedidoFinal, total, formaPagamento });
        document.querySelector('.pagamento').style.display = 'none';
        document.querySelector('.qrcode').style.display = 'block';
      });
    }

    function novoPedido() {
      window.location.reload();
    }

    window.onload = () => {
      carregarProdutos();
    };
  </script>
</body>
</html>
