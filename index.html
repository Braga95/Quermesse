<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PagFesta - Quermesse</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0; padding: 0;
    background: #fffaf0;
    color: #333;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }
  header {
    background-color: #d62828;
    color: white;
    padding: 20px 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
  }
  header h1 {
    margin: 0;
    font-weight: 700;
    font-size: 1.8rem;
  }
  header p {
    margin: 0;
    font-size: 1rem;
  }
  #btnAdmin {
    background: transparent;
    border: 2px solid white;
    color: white;
    font-weight: 600;
    padding: 8px 16px;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #btnAdmin:hover {
    background-color: white;
    color: #d62828;
  }
  .container {
    max-width: 640px;
    margin: 20px auto 40px;
    padding: 15px;
    background: white;
    border-radius: 10px;
    box-shadow: 0 6px 14px rgb(0 0 0 / 0.1);
  }
  h2 {
    color: #d62828;
    margin-top: 0;
  }
  /* Produtos */
  .produto {
    display: flex;
    align-items: center;
    margin: 12px 0;
    justify-content: space-between;
  }
  .produto-info {
    display: flex;
    align-items: center;
    gap: 10px;
    flex: 1;
  }
  .produto input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }
  .produto label {
    cursor: pointer;
    font-weight: 600;
    user-select: none;
  }
  /* Quantidade */
  .quantidade-container {
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .btn-quantidade {
    background: #d62828;
    color: white;
    border: none;
    width: 30px;
    height: 30px;
    border-radius: 4px;
    font-weight: 700;
    cursor: pointer;
    user-select: none;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  .btn-quantidade:active {
    background: #b71c1c;
  }
  input.quantidade {
    width: 40px;
    text-align: center;
    font-weight: 600;
    border: 1px solid #ddd;
    border-radius: 4px;
    height: 30px;
  }
  /* Botão principal */
  .btn {
    background: #d62828;
    color: white;
    border: none;
    padding: 12px 25px;
    cursor: pointer;
    border-radius: 6px;
    font-weight: 700;
    font-size: 1rem;
    margin-top: 25px;
    transition: background-color 0.3s ease;
  }
  .btn:hover {
    background: #b71c1c;
  }
  /* Seções */
  section {
    display: none;
  }
  section.active {
    display: block;
  }
  ul#lista-resumo {
    list-style: none;
    padding-left: 0;
    margin: 0;
  }
  ul#lista-resumo li {
    border-bottom: 1px solid #eee;
    padding: 8px 0;
    font-weight: 600;
    display: flex;
    justify-content: space-between;
  }
  p.total {
    font-weight: 700;
    font-size: 1.3rem;
    margin-top: 15px;
  }
  /* Pagamento */
  .pagamento label {
    margin-right: 20px;
    font-weight: 600;
    cursor: pointer;
    user-select: none;
  }
  /* QR Code */
  .qrcode {
    text-align: center;
  }
  canvas#qr {
    margin-top: 20px;
    width: 280px !important;
    height: 280px !important;
    border: 2px solid #d62828;
    border-radius: 12px;
  }
  p#numero-pedido {
    margin-top: 15px;
    font-weight: 700;
    font-size: 1.2rem;
    color: #d62828;
  }
  /* Modal login admin */
  #modalLogin {
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.55);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 5000;
  }
  #modalLogin.active {
    display: flex;
  }
  #modalLogin .modal-content {
    background: white;
    padding: 25px 30px;
    border-radius: 12px;
    width: 320px;
    box-shadow: 0 6px 20px rgb(0 0 0 / 0.2);
  }
  #modalLogin h3 {
    margin-top: 0;
    color: #d62828;
    text-align: center;
  }
  #modalLogin label {
    font-weight: 600;
    display: block;
    margin-top: 15px;
  }
  #modalLogin input[type="text"],
  #modalLogin input[type="password"] {
    width: 100%;
    padding: 8px 10px;
    margin-top: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }
  #modalLogin button {
    margin-top: 20px;
    background: #d62828;
    color: white;
    border: none;
    width: 100%;
    padding: 10px 0;
    font-weight: 700;
    font-size: 1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }
  #modalLogin button:hover {
    background: #b71c1c;
  }
  #modalLogin .erro {
    margin-top: 10px;
    color: #b71c1c;
    font-weight: 700;
    text-align: center;
  }
  /* Painel Admin */
  #painelAdmin {
    max-width: 900px;
    margin: 20px auto 40px;
    background: white;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgb(0 0 0 / 0.1);
    padding: 20px 30px;
    display: none;
    flex-direction: column;
  }
  #painelAdmin.active {
    display: flex;
  }
  #painelAdmin nav {
    display: flex;
    gap: 15px;
    margin-bottom: 25px;
    flex-wrap: wrap;
  }
  #painelAdmin nav button {
    background: #d62828;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 700;
    transition: background-color 0.3s ease;
  }
  #painelAdmin nav button:hover {
    background: #b71c1c;
  }
  /* Conteúdo interno painel */
  #painelAdmin section.admin-page {
    display: none;
  }
  #painelAdmin section.admin-page.active {
    display: block;
  }
  /* Tabela pedidos */
  table {
    width: 100%;
    border-collapse: collapse;
  }
  table thead {
    background: #d62828;
    color: white;
  }
  table th, table td {
    padding: 8px 12px;
    border: 1px solid #ddd;
    text-align: left;
    vertical-align: middle;
  }
  table tbody tr:nth-child(even) {
    background: #f9f9f9;
  }
  table button {
    background: #1a73e8;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: 600;
    transition: background-color 0.3s ease;
  }
  table button:hover {
    background: #0049b5;
  }
  /* Form banco */
  form#formBanco label {
    display: block;
    margin: 12px 0 5px;
    font-weight: 600;
  }
  form#formBanco input {
    width: 100%;
    padding: 8px 10px;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #ccc;
  }
  form#formBanco button {
    margin-top: 15px;
  }
  /* Form sacar */
  form#formSacar label {
    font-weight: 600;
  }
  form#formSacar input[type="number"] {
    width: 100%;
    padding: 10px 12px;
    border-radius: 6px;
    border: 1px solid #ccc;
    font-size: 1.1rem;
  }
  /* Voltar botão */
  #btnVoltarPedido {
    margin-top: 30px;
    background: #555;
  }
  #btnVoltarPedido:hover {
    background: #222;
  }
  /* Responsividade */
  @media (max-width: 480px) {
    .produto-info {
      flex-direction: column;
      align-items: flex-start;
      gap: 4px;
    }
    header {
      flex-direction: column;
      align-items: flex-start;
      gap: 8px;
    }
  }
</style>
</head>
<body>

<header>
  <h1>PagFesta - Quermesse</h1>
  <button id="btnAdmin">Administrador</button>
</header>

<div class="container" id="telaPedido">

  <h2>Faça seu pedido</h2>
  
  <form id="formPedido">

    <div class="produto">
      <div class="produto-info">
        <input type="checkbox" id="prod1" data-preco="5.00" />
        <label for="prod1">Refrigerante - R$ 5,00</label>
      </div>
      <div class="quantidade-container">
        <button type="button" class="btn-quantidade" data-action="dec" data-target="qtd1">−</button>
        <input type="number" id="qtd1" class="quantidade" min="0" value="0" />
        <button type="button" class="btn-quantidade" data-action="inc" data-target="qtd1">+</button>
      </div>
    </div>

    <div class="produto">
      <div class="produto-info">
        <input type="checkbox" id="prod2" data-preco="3.00" />
        <label for="prod2">Pipoca - R$ 3,00</label>
      </div>
      <div class="quantidade-container">
        <button type="button" class="btn-quantidade" data-action="dec" data-target="qtd2">−</button>
        <input type="number" id="qtd2" class="quantidade" min="0" value="0" />
        <button type="button" class="btn-quantidade" data-action="inc" data-target="qtd2">+</button>
      </div>
    </div>

    <div class="produto">
      <div class="produto-info">
        <input type="checkbox" id="prod3" data-preco="2.00" />
        <label for="prod3">Salgadinho - R$ 2,00</label>
      </div>
      <div class="quantidade-container">
        <button type="button" class="btn-quantidade" data-action="dec" data-target="qtd3">−</button>
        <input type="number" id="qtd3" class="quantidade" min="0" value="0" />
        <button type="button" class="btn-quantidade" data-action="inc" data-target="qtd3">+</button>
      </div>
    </div>

    <button type="submit" class="btn">Gerar Pagamento</button>
  </form>

  <div class="qrcode" id="areaQRCode" style="display:none;">
    <canvas id="qr"></canvas>
    <p id="numero-pedido"></p>
    <button class="btn" id="btnNovoPedido" style="margin-top: 15px;">Gerar Novo Pedido</button>
  </div>

</div>

<!-- Modal Login Admin -->
<div id="modalLogin">
  <div class="modal-content">
    <h3>Login Administrador</h3>
    <form id="formLogin">
      <label for="usuario">Usuário:</label>
      <input type="text" id="usuario" autocomplete="username" required />
      <label for="senha">Senha:</label>
      <input type="password" id="senha" autocomplete="current-password" required />
      <button type="submit">Entrar</button>
      <p class="erro" id="erroLogin" style="display:none;"></p>
    </form>
  </div>
</div>

<!-- Painel Admin -->
<div id="painelAdmin">
  <nav>
    <button data-page="resumo">Resumo</button>
    <button data-page="pedidos">Pedidos</button>
    <button data-page="banco">Cadastro de banco</button>
    <button data-page="sacar">Sacar</button>
    <button id="btnVoltarPedido">Voltar ao Pedido</button>
  </nav>

  <section id="pageResumo" class="admin-page active">
    <h2>Resumo das Vendas</h2>
    <ul id="lista-resumo"></ul>
    <p class="total" id="totalGeral">Total Arrecadado: R$ 0,00</p>
  </section>

  <section id="pagePedidos" class="admin-page">
    <h2>Pedidos Realizados</h2>
    <table>
      <thead>
        <tr>
          <th>Nº Pedido</th>
          <th>Itens</th>
          <th>Quantidade</th>
          <th>Valor Total</th>
          <th>Ação</th>
        </tr>
      </thead>
      <tbody id="tbodyPedidos"></tbody>
    </table>
  </section>

  <section id="pageBanco" class="admin-page">
    <h2>Cadastro de Banco</h2>
    <form id="formBanco">
      <label for="banco">Banco:</label>
      <input type="text" id="banco" required />
      <label for="agencia">Agência:</label>
      <input type="text" id="agencia" required />
      <label for="conta">Conta:</label>
      <input type="text" id="conta" required />
      <button type="submit" class="btn">Salvar Dados</button>
    </form>
    <div id="msgBanco" style="margin-top: 12px; color: green; font-weight: 600;"></div>
  </section>

  <section id="pageSacar" class="admin-page">
    <h2>Sacar</h2>
    <form id="formSacar">
      <label for="valorSaque">Valor para saque (R$):</label>
      <input type="number" id="valorSaque" min="0" step="0.01" required />
      <button type="submit" class="btn">Solicitar Saque</button>
    </form>
    <div id="msgSaque" style="margin-top: 12px; color: green; font-weight: 600;"></div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
(() => {
  // Constantes para login
  const USUARIO_ADMIN = 'lpalmeira';
  const SENHA_ADMIN = '123';

  // Elementos principais
  const btnAdmin = document.getElementById('btnAdmin');
  const modalLogin = document.getElementById('modalLogin');
  const formLogin = document.getElementById('formLogin');
  const erroLogin = document.getElementById('erroLogin');

  const telaPedido = document.getElementById('telaPedido');
  const painelAdmin = document.getElementById('painelAdmin');
  const btnVoltarPedido = document.getElementById('btnVoltarPedido');

  const formPedido = document.getElementById('formPedido');
  const areaQRCode = document.getElementById('areaQRCode');
  const qrCanvas = document.getElementById('qr');
  const numeroPedidoDisplay = document.getElementById('numero-pedido');
  const btnNovoPedido = document.getElementById('btnNovoPedido');

  // Produtos
  const produtos = [
    { id: 'prod1', nome: 'Refrigerante', preco: 5.00, qtdInput: 'qtd1' },
    { id: 'prod2', nome: 'Pipoca', preco: 3.00, qtdInput: 'qtd2' },
    { id: 'prod3', nome: 'Salgadinho', preco: 2.00, qtdInput: 'qtd3' },
  ];

  // Controle de número do pedido
  function getUltimoPedidoNum() {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    if (pedidos.length === 0) return 0;
    return pedidos[pedidos.length - 1].numero;
  }
  function getProximoPedidoNum() {
    return getUltimoPedidoNum() + 1;
  }

  // Atualiza resumo no painel admin
  function atualizarResumo() {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    const resumoMap = new Map();
    let totalGeral = 0;

    pedidos.forEach(pedido => {
      pedido.itens.forEach(item => {
        if (!resumoMap.has(item.nome)) {
          resumoMap.set(item.nome, 0);
        }
        resumoMap.set(item.nome, resumoMap.get(item.nome) + item.quantidade);
      });
      totalGeral += pedido.valorTotal;
    });

    const listaResumo = document.getElementById('lista-resumo');
    listaResumo.innerHTML = '';
    resumoMap.forEach((qtd, nome) => {
      const li = document.createElement('li');
      li.textContent = `${nome}: ${qtd}`;
      listaResumo.appendChild(li);
    });

    document.getElementById('totalGeral').textContent = `Total Arrecadado: R$ ${totalGeral.toFixed(2)}`;
  }

  // Atualiza tabela de pedidos no painel admin
  function atualizarTabelaPedidos() {
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    const tbody = document.getElementById('tbodyPedidos');
    tbody.innerHTML = '';

    pedidos.forEach(pedido => {
      const tr = document.createElement('tr');

      const tdNum = document.createElement('td');
      tdNum.textContent = pedido.numero;
      tr.appendChild(tdNum);

      const tdItens = document.createElement('td');
      tdItens.textContent = pedido.itens.map(i => i.nome).join(', ');
      tr.appendChild(tdItens);

      const tdQtd = document.createElement('td');
      tdQtd.textContent = pedido.itens.reduce((acc, i) => acc + i.quantidade, 0);
      tr.appendChild(tdQtd);

      const tdValor = document.createElement('td');
      tdValor.textContent = `R$ ${pedido.valorTotal.toFixed(2)}`;
      tr.appendChild(tdValor);

      const tdAcao = document.createElement('td');
      const btnGerarNF = document.createElement('button');
      btnGerarNF.textContent = 'Gerar NF';
      btnGerarNF.className = 'btn';
      btnGerarNF.addEventListener('click', () => {
        alert(`Nota fiscal do pedido #${pedido.numero} gerada!`);
      });
      tdAcao.appendChild(btnGerarNF);
      tr.appendChild(tdAcao);

      tbody.appendChild(tr);
    });
  }

  // Alterna páginas no painel admin
  function mudarPaginaAdmin(pagina) {
    const paginas = document.querySelectorAll('.admin-page');
    paginas.forEach(p => p.classList.remove('active'));
    document.getElementById(`page${pagina.charAt(0).toUpperCase() + pagina.slice(1)}`).classList.add('active');
  }

  // Mostrar modal login
  btnAdmin.addEventListener('click', () => {
    modalLogin.style.display = 'flex';
  });

  // Login admin
  formLogin.addEventListener('submit', e => {
    e.preventDefault();
    const usuario = document.getElementById('usuario').value.trim();
    const senha = document.getElementById('senha').value.trim();

    if (usuario === USUARIO_ADMIN && senha === SENHA_ADMIN) {
      modalLogin.style.display = 'none';
      telaPedido.style.display = 'none';
      painelAdmin.style.display = 'block';
      atualizarResumo();
      atualizarTabelaPedidos();
      mudarPaginaAdmin('resumo');
      formLogin.reset();
      erroLogin.style.display = 'none';
    } else {
      erroLogin.textContent = 'Usuário ou senha incorretos.';
      erroLogin.style.display = 'block';
    }
  });

  // Botão voltar para tela pedido
  btnVoltarPedido.addEventListener('click', () => {
    painelAdmin.style.display = 'none';
    telaPedido.style.display = 'block';
  });

  // Controle botões quantidade
  document.querySelectorAll('.btn-quantidade').forEach(btn => {
    btn.addEventListener('click', () => {
      const action = btn.getAttribute('data-action');
      const target = btn.getAttribute('data-target');
      const input = document.getElementById(target);
      let val = parseInt(input.value) || 0;
      if (action === 'inc') val++;
      else if (action === 'dec' && val > 0) val--;
      input.value = val;
    });
  });

  // Gerar pedido e QR code
  formPedido.addEventListener('submit', e => {
    e.preventDefault();

    // Coletar itens selecionados com quantidade > 0
    const itensSelecionados = produtos
      .map(p => {
        const checkbox = document.getElementById(p.id);
        const qtd = parseInt(document.getElementById(p.qtdInput).value) || 0;
        return {
          id: p.id,
          nome: p.nome,
          preco: p.preco,
          quantidade: qtd,
          selecionado: checkbox.checked
        };
      })
      .filter(item => item.selecionado && item.quantidade > 0);

    if (itensSelecionados.length === 0) {
      alert('Selecione pelo menos um item com quantidade maior que zero.');
      return;
    }

    const numeroPedido = getProximoPedidoNum();

    const valorTotal = itensSelecionados.reduce((acc, item) => acc + item.preco * item.quantidade, 0);

    // Criar dados para QR Code (simples string JSON)
    const dadosQRCode = JSON.stringify({
      pedido: numeroPedido,
      itens: itensSelecionados.map(i => ({ nome: i.nome, quantidade: i.quantidade })),
      total: valorTotal.toFixed(2)
    });

    QRCode.toCanvas(qrCanvas, dadosQRCode, { width: 220 }, err => {
      if (err) {
        alert('Erro ao gerar QR Code: ' + err);
        return;
      }
      areaQRCode.style.display = 'block';
      formPedido.style.display = 'none';
      numeroPedidoDisplay.textContent = `Número do Pedido: ${numeroPedido}`;
    });

    // Salvar pedido no localStorage
    const pedidos = JSON.parse(localStorage.getItem('pedidos') || '[]');
    pedidos.push({
      numero: numeroPedido,
      itens: itensSelecionados,
      valorTotal: valorTotal
    });
    localStorage.setItem('pedidos', JSON.stringify(pedidos));
  });

  // Gerar novo pedido
  btnNovoPedido.addEventListener('click', () => {
    areaQRCode.style.display = 'none';
    formPedido.style.display = 'block';
    formPedido.reset();
    // Reset quantidades para zero
    produtos.forEach(p => {
      document.getElementById(p.qtdInput).value = 0;
      document.getElementById(p.id).checked = false;
    });
  });

  // Navegação no painel admin
  document.querySelectorAll('#painelAdmin nav button[data-page]').forEach(btn => {
    btn.addEventListener('click', () => {
      mudarPaginaAdmin(btn.getAttribute('data-page'));
    });
  });

  // Formulário banco (simplesmente salva e mostra mensagem)
  const formBanco = document.getElementById('formBanco');
  const msgBanco = document.getElementById('msgBanco');

  formBanco.addEventListener('submit', e => {
    e.preventDefault();
    const banco = document.getElementById('banco').value.trim();
    const agencia = document.getElementById('agencia').value.trim();
    const conta = document.getElementById('conta').value.trim();

    localStorage.setItem('dadosBanco', JSON.stringify({ banco, agencia, conta }));
    msgBanco.textContent = 'Dados do banco salvos com sucesso!';
    formBanco.reset();
  });

  // Formulário sacar (simples, só mostra mensagem)
  const formSacar = document.getElementById('formSacar');
  const msgSaque = document.getElementById('msgSaque');

  formSacar.addEventListener('submit', e => {
    e.preventDefault();
    const valorSaque = parseFloat(document.getElementById('valorSaque').value);
    if (isNaN(valorSaque) || valorSaque <= 0) {
      alert('Informe um valor válido para saque.');
      return;
    }
    msgSaque.textContent = `Solicitação de saque de R$ ${valorSaque.toFixed(2)} recebida.`;
    formSacar.reset();
  });

})();
</script>

</body>
</html>
