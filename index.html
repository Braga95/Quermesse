<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PagFesta - Compra e Administração</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    max-width: 900px;
    margin-left: auto;
    margin-right: auto;
    background: #fffaf0;
    color: #333;
  }
  header {
    background: #d62828;
    color: white;
    padding: 15px;
    text-align: center;
    position: relative;
  }
  header button {
    position: absolute;
    top: 15px;
    right: 15px;
    background: white;
    color: #d62828;
    border: none;
    padding: 8px 14px;
    font-weight: bold;
    border-radius: 4px;
    cursor: pointer;
  }
  header button:hover {
    background: #f8f1f1;
  }
  section {
    display: none;
    padding: 20px;
  }
  section.active {
    display: block;
  }
  /* Estilo Formulário */
  form label {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }
  form label span {
    width: 120px;
  }
  input[type="number"] {
    width: 40px;
    text-align: center;
    font-size: 1rem;
    margin: 0 8px;
  }
  button.mais, button.menos {
    background: #d62828;
    border: none;
    color: white;
    font-weight: bold;
    width: 26px;
    height: 26px;
    cursor: pointer;
    border-radius: 4px;
  }
  button.mais:hover, button.menos:hover {
    background: #b71c1c;
  }
  /* Botões gerais */
  button.btn {
    background: #d62828;
    color: white;
    border: none;
    padding: 10px 18px;
    border-radius: 5px;
    cursor: pointer;
    font-weight: bold;
    margin-top: 20px;
  }
  button.btn:hover {
    background: #b71c1c;
  }
  /* Resumo */
  ul#lista-resumo {
    list-style: none;
    padding-left: 0;
  }
  ul#lista-resumo li {
    margin-bottom: 6px;
  }
  #valor-total {
    font-weight: bold;
    margin-top: 10px;
  }
  /* QR Code */
  #qr {
    margin: 0 auto;
    display: block;
    width: 280px !important;
    height: 280px !important;
  }
  #numero-pedido {
    text-align: center;
    margin-top: 10px;
    font-weight: bold;
    font-size: 1.2rem;
  }
  /* Tabela Admin */
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 15px;
  }
  th, td {
    border: 1px solid #d62828;
    padding: 8px;
    text-align: center;
  }
  th {
    background: #d62828;
    color: white;
  }
  /* Seções Admin internas */
  nav.admin-menu {
    margin-bottom: 15px;
  }
  nav.admin-menu button {
    background: #d62828;
    color: white;
    border: none;
    padding: 8px 14px;
    margin-right: 8px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
  }
  nav.admin-menu button:hover {
    background: #b71c1c;
  }
  /* Form banco e sacar */
  .admin-page {
    display: none;
  }
  .admin-page.active {
    display: block;
  }
  .input-group {
    margin-bottom: 10px;
  }
  .input-group label {
    display: block;
    font-weight: bold;
    margin-bottom: 4px;
  }
  .input-group input, .input-group textarea {
    width: 100%;
    padding: 6px;
    box-sizing: border-box;
    border-radius: 4px;
    border: 1px solid #ccc;
  }
</style>
</head>
<body>

<header>
  <h1>PagFesta</h1>
  <button id="btn-admin">Administrador</button>
  <button id="btn-voltar-inicio" style="display:none; position:absolute; left:15px; top:15px;">← Início</button>
</header>

<!-- TELA DE COMPRA (CLIENTE) -->
<section id="sec-pedido" class="active">
  <form id="formulario">
    <label><span>Pastel</span>
      <button type="button" class="menos" data-produto="pastel">-</button>
      <input type="number" name="pastel" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="pastel">+</button>
    </label>
    <label><span>Hot Dog</span>
      <button type="button" class="menos" data-produto="hotdog">-</button>
      <input type="number" name="hotdog" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="hotdog">+</button>
    </label>
    <label><span>Doces</span>
      <button type="button" class="menos" data-produto="doces">-</button>
      <input type="number" name="doces" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="doces">+</button>
    </label>
    <label><span>Caldinho</span>
      <button type="button" class="menos" data-produto="caldinho">-</button>
      <input type="number" name="caldinho" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="caldinho">+</button>
    </label>
    <label><span>Refrigerante</span>
      <button type="button" class="menos" data-produto="refri">-</button>
      <input type="number" name="refri" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="refri">+</button>
    </label>
    <label><span>Espeto</span>
      <button type="button" class="menos" data-produto="espeto">-</button>
      <input type="number" name="espeto" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="espeto">+</button>
    </label>
    <label><span>Suco</span>
      <button type="button" class="menos" data-produto="suco">-</button>
      <input type="number" name="suco" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="suco">+</button>
    </label>
    <label><span>Água</span>
      <button type="button" class="menos" data-produto="agua">-</button>
      <input type="number" name="agua" value="0" min="0" readonly />
      <button type="button" class="mais" data-produto="agua">+</button>
    </label>

    <button type="submit" class="btn">Avançar para Resumo</button>
  </form>
</section>

<!-- TELA DE RESUMO -->
<section id="sec-resumo">
  <h2>Resumo do Pedido</h2>
  <ul id="lista-resumo"></ul>
  <div id="valor-total"></div>

  <button id="btn-voltar-pedido" class="btn">Voltar</button>
  <button id="btn-ir-pagamento" class="btn">Ir para Pagamento</button>
</section>

<!-- TELA DE PAGAMENTO -->
<section id="sec-pagamento">
  <h2>Forma de Pagamento</h2>
  <form id="form-pagamento">
    <label><input type="radio" name="pagamento" value="Pix" checked /> Pix</label><br/>
    <label><input type="radio" name="pagamento" value="Cartão" /> Cartão</label><br/>
  </form>
  <button id="btn-voltar-resumo" class="btn">Voltar</button>
  <button id="btn-gerar-pedido" class="btn">Gerar Pedido</button>

  <div id="qrcode" style="margin-top:20px;"></div>
  <div id="numero-pedido"></div>
  <button id="btn-novo-pedido" class="btn" style="display:none; margin-top:20px;">Gerar Novo Pedido</button>
</section>

<!-- TELA ADMINISTRADOR -->
<section id="sec-admin">
  <nav class="admin-menu">
    <button data-adminpage="resumo-vendas">Resumo</button>
    <button data-adminpage="lista-pedidos">Pedidos</button>
    <button data-adminpage="cadastro-banco">Cadastro de Banco</button>
    <button data-adminpage="sacar">Sacar</button>
  </nav>
  <!-- Páginas Admin -->
  <div id="resumo-vendas" class="admin-page active">
    <h2>Resumo de Vendas</h2>
    <ul id="resumo-itens"></ul>
    <div id="resumo-total"></div>
  </div>
  <div id="lista-pedidos" class="admin-page">
    <h2>Pedidos</h2>
    <table>
      <thead>
        <tr><th>Número</th><th>Data</th><th>Itens</th><th>Pagamento</th><th>Total (R$)</th><th>Gerar NF</th></tr>
      </thead>
      <tbody id="tabela-pedidos"></tbody>
    </table>
  </div>
  <div id="cadastro-banco" class="admin-page">
    <h2>Cadastro de Banco</h2>
    <form id="form-banco">
      <div class="input-group">
        <label for="banco-nome">Nome do Banco</label>
        <input id="banco-nome" type="text" required />
      </div>
      <div class="input-group">
        <label for="banco-agencia">Agência</label>
        <input id="banco-agencia" type="text" required />
      </div>
      <div class="input-group">
        <label for="banco-conta">Conta</label>
        <input id="banco-conta" type="text" required />
      </div>
      <div class="input-group">
        <label for="banco-titular">Titular</label>
        <input id="banco-titular" type="text" required />
      </div>
      <button type="submit" class="btn">Salvar Dados</button>
    </form>
    <div id="msg-banco" style="margin-top:10px; color:green;"></div>
  </div>
  <div id="sacar" class="admin-page">
    <h2>Sacar</h2>
    <p>Aqui você pode registrar saques (simulação).</p>
    <form id="form-sacar">
      <div class="input-group">
        <label for="valor-saque">Valor a sacar (R$)</label>
        <input id="valor-saque" type="number" min="0" step="0.01" required />
      </div>
      <button type="submit" class="btn">Registrar Saque</button>
    </form>
    <div id="msg-saque" style="margin-top:10px; color:green;"></div>
  </div>
</section>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

<!-- QRCode.js -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script>
  // Config Firebase (substitua pelos seus dados)
  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_AUTH_DOMAIN",
    databaseURL: "SUA_DATABASE_URL",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_STORAGE_BUCKET",
    messagingSenderId: "SEU_MESSAGING_SENDER_ID",
    appId: "SEU_APP_ID"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ELEMENTOS PRINCIPAIS
  const btnAdmin = document.getElementById('btn-admin');
  const btnVoltarInicio = document.getElementById('btn-voltar-inicio');

  const secPedido = document.getElementById('sec-pedido');
  const secResumo = document.getElementById('sec-resumo');
  const secPagamento = document.getElementById('sec-pagamento');
  const secAdmin = document.getElementById('sec-admin');

  // BOTÕES DE NAVEGAÇÃO INTERNA ADMIN
  const adminButtons = document.querySelectorAll('nav.admin-menu button');
  const adminPages = document.querySelectorAll('.admin-page');

  // FORMULÁRIOS E CAMPOS
  const formulario = document.getElementById('formulario');
  const listaResumo = document.getElementById('lista-resumo');
  const valorTotal = document.getElementById('valor-total');

  const btnVoltarPedido = document.getElementById('btn-voltar-pedido');
  const btnIrPagamento = document.getElementById('btn-ir-pagamento');

  const formPagamento = document.getElementById('form-pagamento');
  const btnVoltarResumo = document.getElementById('btn-voltar-resumo');
  const btnGerarPedido = document.getElementById('btn-gerar-pedido');

  const qrcodeContainer = document.getElementById('qrcode');
  const numeroPedidoEl = document.getElementById('numero-pedido');
  const btnNovoPedido = document.getElementById('btn-novo-pedido');

  const tabelaPedidosBody = document.getElementById('tabela-pedidos');

  // BANCO
  const formBanco = document.getElementById('form-banco');
  const msgBanco = document.getElementById('msg-banco');

  // SACAR
  const formSacar = document.getElementById('form-sacar');
  const msgSaque = document.getElementById('msg-saque');

  // RESUMO VENDAS
  const resumoItens = document.getElementById('resumo-itens');
  const resumoTotal = document.getElementById('resumo-total');

  // Controle visibilidade das seções
  function mostrarSecao(sec) {
    // esconder todas
    [secPedido, secResumo, secPagamento, secAdmin].forEach(s => s.classList.remove('active'));
    sec.classList.add('active');
  }

  // Controle páginas admin internas
  function mostrarPaginaAdmin(paginaId) {
    adminPages.forEach(p => p.classList.remove('active'));
    document.getElementById(paginaId).classList.add('active');
  }

  // Mudar tela para admin
  btnAdmin.addEventListener('click', () => {
    mostrarSecao(secAdmin);
    btnAdmin.style.display = 'none';
    btnVoltarInicio.style.display = 'inline-block';
    mostrarPaginaAdmin('resumo-vendas');
    carregarResumoVendas();
  });

  // Voltar para tela cliente
  btnVoltarInicio.addEventListener('click', () => {
    mostrarSecao(secPedido);
    btnAdmin.style.display = 'inline-block';
    btnVoltarInicio.style.display = 'none';
  });

  // Navegação interna admin
  adminButtons.forEach(btn => {
    btn.addEventListener('click', () => {
      mostrarPaginaAdmin(btn.getAttribute('data-adminpage'));
      if(btn.getAttribute('data-adminpage') === 'lista-pedidos') carregarPedidos();
    });
  });

  // + e - para quantidade dos produtos
  document.querySelectorAll('button.mais').forEach(btn => {
    btn.addEventListener('click', () => {
      const produto = btn.getAttribute('data-produto');
      const input = formulario.elements[produto];
      input.value = Number(input.value) + 1;
    });
  });
  document.querySelectorAll('button.menos').forEach(btn => {
    btn.addEventListener('click', () => {
      const produto = btn.getAttribute('data-produto');
      const input = formulario.elements[produto];
      if (Number(input.value) > 0) input.value = Number(input.value) - 1;
    });
  });

  // Avançar para resumo
  formulario.addEventListener('submit', e => {
    e.preventDefault();
    const itensSelecionados = {};
    let total = 0;
    // preços fixos para exemplo
    const precos = {
      pastel: 5.0,
      hotdog: 7.0,
      doces: 4.0,
      caldinho: 6.0,
      refri: 3.0,
      espeto: 4.5,
      suco: 4.0,
      agua: 2.0
    };
    listaResumo.innerHTML = '';
    for (const nome in precos) {
      const qtd = Number(formulario.elements[nome].value);
      if (qtd > 0) {
        itensSelecionados[nome] = qtd;
        const li = document.createElement('li');
        li.textContent = `${nome.charAt(0).toUpperCase() + nome.slice(1)}: ${qtd} x R$${precos[nome].toFixed(2)}`;
        listaResumo.appendChild(li);
        total += qtd * precos[nome];
      }
    }
    if (Object.keys(itensSelecionados).length === 0) {
      alert('Selecione pelo menos um item.');
      return;
    }
    valorTotal.textContent = `Total: R$ ${total.toFixed(2)}`;
    mostrarSecao(secResumo);

    // salvar dados temporariamente
    window.itensSelecionados = itensSelecionados;
    window.totalPedido = total;
  });

  // Voltar para pedido
  btnVoltarPedido.addEventListener('click', () => {
    mostrarSecao(secPedido);
  });

  // Ir para pagamento
  btnIrPagamento.addEventListener('click', () => {
    mostrarSecao(secPagamento);
  });

  // Voltar para resumo
  btnVoltarResumo.addEventListener('click', () => {
    mostrarSecao(secResumo);
  });

  // Gerar pedido no Firebase
  btnGerarPedido.addEventListener('click', async () => {
    btnGerarPedido.disabled = true;
    // buscar último número salvo
    let ultimoNum = 0;
    const numSnap = await db.ref('ultimoNumeroPedido').get();
    if (numSnap.exists()) ultimoNum = numSnap.val();
    const novoNum = ultimoNum + 1;

    const pedido = {
      numero: novoNum,
      data: new Date().toISOString(),
      itens: window.itensSelecionados,
      total: window.totalPedido,
      pagamento: 'pendente',
      qrCodeGerado: false
    };

    // salvar pedido
    await db.ref('pedidos/' + novoNum).set(pedido);
    await db.ref('ultimoNumeroPedido').set(novoNum);

    // gerar QR Code (exemplo de link de pagamento)
    const linkPagamento = `https://pagamento.exemplo.com/pagar?pedido=${novoNum}&valor=${pedido.total.toFixed(2)}`;
    qrcodeContainer.innerHTML = '';
    QRCode.toCanvas(qrcodeContainer, linkPagamento, { width: 200 }, function (error) {
      if (error) console.error(error);
    });

    numeroPedidoEl.textContent = `Número do Pedido: ${novoNum}`;
    btnNovoPedido.style.display = 'inline-block';
    mostrarSecao(secPagamento);
  });

  // Gerar novo pedido (resetar)
  btnNovoPedido.addEventListener('click', () => {
    formulario.reset();
    qrcodeContainer.innerHTML = '';
    numeroPedidoEl.textContent = '';
    btnNovoPedido.style.display = 'none';
    btnGerarPedido.disabled = false;
    mostrarSecao(secPedido);
  });

  // Carregar lista de pedidos para admin
  async function carregarPedidos() {
    tabelaPedidosBody.innerHTML = '';
    const pedidosSnap = await db.ref('pedidos').get();
    if (!pedidosSnap.exists()) return;
    const pedidos = pedidosSnap.val();
    for (const num in pedidos) {
      const p = pedidos[num];
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${p.numero}</td>
        <td>${new Date(p.data).toLocaleString()}</td>
        <td>${Object.entries(p.itens).map(([k,v]) => `${k}(${v})`).join(', ')}</td>
        <td>${p.pagamento}</td>
        <td>${p.total.toFixed(2)}</td>
        <td><button onclick="gerarNF(${p.numero})">Gerar NF</button></td>
      `;
      tabelaPedidosBody.appendChild(tr);
    }
  }

  // Função para gerar NF (simulação)
  function gerarNF(numero) {
    alert(`Nota Fiscal gerada para o pedido ${numero}`);
  }

  // Cadastro banco
  formBanco.addEventListener('submit', async e => {
    e.preventDefault();
    const dadosBanco = {
      nome: formBanco['banco-nome'].value,
      agencia: formBanco['banco-agencia'].value,
      conta: formBanco['banco-conta'].value,
      titular: formBanco['banco-titular'].value
    };
    await db.ref('dadosBanco').set(dadosBanco);
    msgBanco.textContent = 'Dados salvos com sucesso!';
    formBanco.reset();
    setTimeout(() => { msgBanco.textContent = ''; }, 3000);
  });

  // Registrar saque (simulação)
  formSacar.addEventListener('submit', async e => {
    e.preventDefault();
    const valorSaque = Number(formSacar['valor-saque'].value);
    // para simular, só armazenar o saque
    await db.ref('saques').push({ valor: valorSaque, data: new Date().toISOString() });
    msgSaque.textContent = 'Saque registrado com sucesso!';
    formSacar.reset();
    setTimeout(() => { msgSaque.textContent = ''; }, 3000);
  });

  // Carregar resumo vendas
  async function carregarResumoVendas() {
    resumoItens.innerHTML = '';
    resumoTotal.textContent = '';
    const pedidosSnap = await db.ref('pedidos').get();
    if (!pedidosSnap.exists()) {
      resumoItens.textContent = 'Nenhuma venda registrada.';
      return;
    }
    const pedidos = pedidosSnap.val();
    const totais = {};
    let somaTotal = 0;
    for (const num in pedidos) {
      const p = pedidos[num];
      for (const item in p.itens) {
        if (!totais[item]) totais[item] = 0;
        totais[item] += p.itens[item];
      }
      somaTotal += p.total;
    }
    for (const item in totais) {
      const li = document.createElement('li');
      li.textContent = `${item.charAt(0).toUpperCase() + item.slice(1)}: ${totais[item]}`;
      resumoItens.appendChild(li);
    }
    resumoTotal.textContent = `Total arrecadado: R$ ${somaTotal.toFixed(2)}`;
  }
</script>

<style>
  /* estilos similares, ajuste para layout único */
  body { font-family: Arial, sans-serif; margin: 20px; background: #f9f9f9; }
  section { display: none; }
  section.active { display: block; }
  h1, h2 { color: #333; }
  form { margin-bottom: 15px; }
  label { display: block; margin-top: 10px; }
  input[type="number"], input[type="text"] { width: 60px; }
  button { margin: 5px; padding: 6px 12px; cursor: pointer; }
  nav.admin-menu { margin-bottom: 15px; }
  nav.admin-menu button { background-color: #007BFF; color: white; border: none; padding: 6px 12px; margin-right: 5px; }
  nav.admin-menu button:hover { background-color: #0056b3; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: left; }
</style>
</body>
</html>
