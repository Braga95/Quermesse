<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBJaxoo8XTmb02jLqGAsL9wRfpCq8cpXJQ",
    authDomain: "banco0-eeda3.firebaseapp.com",
    projectId: "banco0-eeda3",
    storageBucket: "banco0-eeda3.firebasestorage.app",
    messagingSenderId: "1048527206329",
    appId: "1:1048527206329:web:12b730b48feeeb7bb2a868",
    measurementId: "G-8L4L1KGD7N"
  };
 firebase.initializeApp(firebaseConfig); [cite: 213]
  const db = firebase.database();
</script>
    
    
    <title>Quermesse - Nossa Senhora da Boa Esperan√ßa</title>
    <link rel="icon" href="https://github.com/Braga95/Quermesse/blob/main/pagfesta-removebg-preview.png?raw=true" type="image/png">
    <style>
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
 max-width: 850px; /* Largura ajustada para acomodar ambos os layouts */ [cite: 214]
            margin: 20px auto;
 padding: 25px; [cite: 215]
            background: #f7f7f7;
            color: #333;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            border-radius: 12px;
 } [cite: 216]
        .header {
            text-align: center;
 margin-bottom: 30px; [cite: 217]
        }
        .header h1 {
            color: #d63333;
 font-size: 2.8em; [cite: 218]
            margin-bottom: 5px;
            letter-spacing: 1px;
        }
        .header p {
            color: #666;
 font-size: 1.1em; [cite: 219]
            margin-top: 0;
        }
        /* Estilos da P√°gina de Pedido */
        #order-section {
            display: block;
 /* Vis√≠vel por padr√£o ao carregar */ [cite: 220]
        }
        .produto {
            display: flex;
 align-items: center; [cite: 221]
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: white;
 transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out; [cite: 222]
        }
        .produto:hover {
            transform: translateY(-3px);
 box-shadow: 0 4px 10px rgba(0,0,0,0.08); [cite: 223]
        }
        .produto label {
            flex: 1;
 font-size: 1.1em; [cite: 224]
            color: #555;
        }
        .qtd-container {
            display: flex;
 align-items: center; [cite: 225]
        }
        .qtd-container button {
            width: 32px;
 height: 32px; [cite: 226]
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #d63333;
            background: #ffe0e0;
            color: #d63333;
            border-radius: 50%;
 margin: 0 8px; [cite: 227]
            user-select: none;
            transition: background 0.2s;
        }
        .qtd-container button:hover {
            background: #d63333;
 color: white; [cite: 228]
        }
        .qtd-container input[type=number] {
            width: 50px;
 text-align: center; [cite: 229]
            border: 1px solid #d63333;
            border-radius: 6px;
            font-size: 18px;
            padding: 6px 0;
            -moz-appearance: textfield;
 } [cite: 230]
        .qtd-container input[type=number]::-webkit-outer-spin-button,
        .qtd-container input[type=number]::-webkit-inner-spin-button {
            -webkit-appearance: none;
 margin: 0; [cite: 231]
        }
        button#btnGerarPagamento {
            display: block;
 margin: 30px auto 0; [cite: 232]
            background: #d63333;
            color: white;
            font-size: 20px;
            padding: 12px 30px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
 transition: background 0.3s ease, transform 0.2s ease; [cite: 233]
        }
        button#btnGerarPagamento:hover {
            background: #b52b2b;
 transform: translateY(-2px); [cite: 234]
        }
        #resumoPedido, #telaPagamento, #areaQRCode {
            margin-top: 30px;
 padding: 20px; [cite: 235]
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
 } [cite: 236]
        #resumoPedido h2, #telaPagamento h2, #areaQRCode h2 {
            color: #d63333;
 margin-bottom: 20px; [cite: 237]
        }
        #resumoPedido p {
            margin: 8px 0;
 font-size: 1.1em; [cite: 238]
        }
        #resumoPedido strong {
            font-size: 20px;
 color: #333; [cite: 239]
        }
        #resumoPedido #itensResumo {
            margin-bottom: 15px;
 } [cite: 240]
        #btnAvancarPagamento, #btnGerarQRCode, #btnNovoPedido,
        #btnVoltarInicioResumo, #btnVoltarResumo {
            background: #d63333;
 color: white; [cite: 241]
            border: none;
            padding: 10px 22px;
            font-size: 17px;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 20px;
 transition: background 0.3s ease, transform 0.2s ease; [cite: 242]
        }
        #btnAvancarPagamento:hover,
        #btnGerarQRCode:hover,
        #btnNovoPedido:hover,
        #btnVoltarInicioResumo:hover,
        #btnVoltarResumo:hover {
            background: #b52b2b;
 transform: translateY(-2px); [cite: 243]
        }
        #telaPagamento label {
            display: block;
 margin-bottom: 12px; [cite: 244]
            font-size: 1.1em;
            cursor: pointer;
            text-align: left;
            padding-left: 50px;
 } [cite: 245]
        #telaPagamento input[type="radio"] {
            margin-right: 8px;
 transform: scale(1.2); [cite: 246]
            vertical-align: middle;
        }
        #qrCanvas {
            display: block;
 margin: 25px auto; [cite: 247]
            border: 1px solid #eee;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-radius: 8px;
 } [cite: 248]
        #numeroPedidoDisplay {
            text-align: center;
 font-size: 22px; [cite: 249]
            font-weight: bold;
            margin-top: 15px;
            color: #d63333;
        }
/* Bot√£o PagFesta */
#btnPagFesta {
    position: fixed;
    top: 20px;
 right: 160px; /* afasta do bot√£o Administrador */ [cite: 250]
    font-weight: bold;
    background: #2a9d8f;
    color: white;
    padding: 8px 15px;
 border-radius: 8px; [cite: 251]
    text-decoration: none;
    font-size: 15px;
    z-index: 10;
    cursor: pointer;
    border: none;
    transition: background 0.3s ease, transform 0.2s ease;
 } [cite: 252]
#btnPagFesta:hover {
    background: #21867a;
    transform: translateY(-2px);
}
        
        /* Bot√£o Administrador */
        #btnAdminArea {
            position: fixed;
 top: 20px; [cite: 253]
            right: 20px;
            font-weight: bold;
            background: #5c677d;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 15px;
 z-index: 10; [cite: 254]
            cursor: pointer;
            border: none;
            transition: background 0.3s ease, transform 0.2s ease;
 } [cite: 255]
        #btnAdminArea:hover {
            background: #4a5264;
 transform: translateY(-2px); [cite: 256]
        }
        /* Estilos do Painel de Administra√ß√£o */
        #admin-section {
            display: none;
 /* Oculto por padr√£o */ [cite: 257]
            background: white;
            padding: 25px;
 border-radius: 10px; [cite: 258]
            border: 1px solid #e0e0e0;
            margin-bottom: 25px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
            text-align: center;
 } [cite: 259]
        #login-form {
            text-align: center;
 padding: 20px; [cite: 260]
        }
        #login-form input {
            padding: 12px;
 margin: 8px auto; [cite: 261]
            width: 80%;
            max-width: 300px;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: block;
 } [cite: 262]
        #login-form button {
            background: #d63333;
 color: white; [cite: 263]
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 15px;
 transition: background 0.3s ease, transform 0.2s ease; [cite: 264]
        }
        #login-form button:hover {
            background: #b52b2b;
 transform: translateY(-2px); [cite: 265]
        }
        .tabs {
            display: flex;
 justify-content: center; [cite: 266]
            margin-bottom: 25px;
            border-bottom: 2px solid #ddd;
        }
        .tabs button {
            background: #eee;
 border: none; [cite: 267]
            padding: 12px 20px;
            cursor: pointer;
            font-size: 17px;
            border-top-left-radius: 8px;
            border-top-right-radius: 8px;
            margin: 0 3px;
 transition: background 0.3s ease, color 0.3s ease; [cite: 268]
            font-weight: bold;
            color: #666;
 } [cite: 269]
        .tabs button.active {
            background: #d63333;
 color: white; [cite: 270]
            border-bottom: 2px solid #d63333;
        }
        .tabs button:hover:not(.active) {
            background: #e5e5e5;
 } [cite: 271]
        .tab-content {
            display: none;
 text-align: left; [cite: 272]
            padding: 15px 0;
        }
        .tab-content.active {
            display: block;
 } [cite: 273]
        table {
            width: 100%;
 border-collapse: collapse; [cite: 274]
            margin-top: 15px;
            background-color: #fff;
        }
        th, td {
            border: 1px solid #eee;
 padding: 10px; [cite: 275]
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
 color: #555; [cite: 276]
            font-weight: bold;
        }
        .order-item {
            border: 1px solid #e0e0e0;
 padding: 15px; [cite: 277]
            margin-bottom: 15px;
            border-radius: 8px;
            background-color: #fcfcfc;
            box-shadow: 0 1px 5px rgba(0,0,0,0.05);
 } [cite: 278]
        .order-item h3 {
            margin-top: 0;
 color: #d63333; [cite: 279]
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            margin-bottom: 10px;
 } [cite: 280]
        .order-item ul {
            list-style: none;
 padding: 0; [cite: 281]
            margin: 0;
        }
        .order-item ul li {
            padding: 5px 0;
 border-bottom: 1px dotted #f0f0f0; [cite: 282]
        }
        .order-item ul li:last-child {
            border-bottom: none;
 } [cite: 283]
        .order-item button {
            background: #4CAF50;
 color: white; [cite: 284]
            border: none;
            padding: 9px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 15px;
            transition: background 0.3s ease, transform 0.2s ease;
 } [cite: 285]
        .order-item button:hover {
            background: #45a049;
 transform: translateY(-2px); [cite: 286]
        }
        .bank-info p, .withdraw-info p {
            margin-bottom: 12px;
 font-size: 1.1em; [cite: 287]
        }
        .bank-info input[type="text"],
        .bank-info input[type="number"] {
            width: calc(100% - 20px);
 max-width: 400px; [cite: 288]
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 6px;
            display: block;
            margin-left: auto;
            margin-right: auto;
 } [cite: 289]
        .bank-info button, .withdraw-info button {
            background: #d63333;
 color: white; [cite: 290]
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            margin-top: 15px;
 transition: background 0.3s ease, transform 0.2s ease; [cite: 291]
        }
        .bank-info button:hover, .withdraw-info button:hover {
            background: #b52b2b;
 transform: translateY(-2px); [cite: 292]
        }
        #withdrawAmount {
            width: 150px;
 padding: 10px; [cite: 293]
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-right: 15px;
            font-size: 1em;
            text-align: center;
 } [cite: 294]
        #backToOrder {
            display: block;
 margin: 30px auto 0; [cite: 295]
            background: #6c757d;
            color: white;
            font-size: 18px;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
 text-align: center; [cite: 296]
            text-decoration: none;
            width: fit-content;
            transition: background 0.3s ease, transform 0.2s ease;
 } [cite: 297]
        #backToOrder:hover {
            background: #5a6268;
 transform: translateY(-2px); [cite: 298]
        }
    </style>
</head>
<body>
  
    <button id="btnAdminArea">Administrador</button>
    <a href="https://braga95.github.io/PagFesta/" id="btnPagFesta" target="_blank">PagFesta</a>
      <div id="order-section">
          
<div class="header" style="position: relative; text-align: center;">
  <img src="https://github.com/Braga95/Quermesse/blob/main/pagfesta-removebg-preview.png?raw=true"
       alt="Logo PagFesta"
       style="position: absolute; left: 0; top: 50%; transform: translateY(-50%); height: 180px;"
 /> [cite: 299]
  
  <div>
    <h1>Quermesse</h1>
    <p>Nossa Senhora da Boa Esperan√ßa</p>
  </div>
</div>
        <form id="formPedido">
            <div id="produtos-cliente">
              </div>
            <button id="btnGerarPagamento" type="submit">Gerar pagamento</button>
  
 </form> [cite: 304]
        <div id="resumoPedido" style="display:none;">
            <h2>Resumo do Pedido</h2>
            <div id="itensResumo"></div>
            <p><strong>Total: R$ <span id="totalResumo">0.00</span></strong></p>
            <button id="btnAvancarPagamento">Avan√ßar para pagamento</button>
            <button id="btnVoltarInicioResumo" style="margin-left:10px;">Voltar</button>
        </div>
     
 <div id="telaPagamento" style="display:none;"> [cite: 305]
            <h2>Escolha a forma de pagamento</h2>
            <label><input type="radio" name="pagamento" value="pix" /> Pix</label>
            <label><input type="radio" name="pagamento" value="cartao" /> Cart√£o de Cr√©dito</label>
            <label><input type="radio" name="pagamento" value="boleto" /> Boleto</label>
            <button id="btnGerarQRCode">Gerar QR Code</button>
           
  <button id="btnVoltarResumo" style="margin-left:10px;">Voltar</button> [cite: 306]
        </div>
        <div id="areaQRCode" style="display:none;">
            <h2>Pagamento QR Code</h2>
            <canvas id="qrCanvas" width="250" height="250"></canvas>
            <div id="numeroPedidoDisplay"></div>
            <button id="btnNovoPedido" style="margin-top:20px;">Gerar novo pedido</button>
        </div>
    </div>
    <div id="admin-section">
    
 <div class="header"> [cite: 307]
            <h1>Quermesse - Administra√ß√£o</h1>
            <p>Gerencie seus pedidos e finan√ßas com facilidade.</p>
        </div>
        <div id="login-screen" class="admin-section-inner">
            <h2>Login</h2>
            <form id="login-form">
                <input type="text" id="username" placeholder="Usu√°rio" 
 required /><br /> [cite: 308]
                <input type="password" id="password" placeholder="Senha" required /><br />
                <button type="submit">Entrar</button>
                <button id="backToOrderLogin">Voltar</button>
                
            </form>
            <p id="login-message" style="color: red;
 margin-top: 10px;"></p> [cite: 309]
        </div>
        <div id="admin-panel" style="display: none;">
            <div class="tabs">
                <button class="tab-button" data-tab="produtos">Produtos</button>
                <button class="tab-button active" data-tab="summary">Resumo</button>
                <button class="tab-button" data-tab="orders">Pedidos</button>
            
  <button class="tab-button" data-tab="bank">Banco</button> [cite: 310]
                <button class="tab-button" data-tab="withdraw">Sacar</button>
                <button class="tab-button" data-tab="scanner">QRCODE</button>
                
            </div>
            <div id="produtos-tab" class="tab-content admin-section-inner">
                <h2>Gerenciar Produtos</h2>
                <input type="text" id="novoProdutoNome" placeholder="Nome do Produto">
                <input type="number" id="novoProdutoPreco" placeholder="Pre√ßo (ex: 5.00)" step="0.01">
                <button id="btnAdicionarProduto">Adicionar Produto</button>
                <h3>Produtos Cadastrados</h3>
                <ul id="listaProdutos"></ul>
            </div>
            
 
 <div id="summary-tab" class="tab-content active admin-section-inner"> [cite: 311]
                <h2>Resumo das Vendas</h2>
                <div id="sales-summary">
                    <p>Nenhuma venda registrada ainda.</p>
                </div>
           
       <p><strong>Total de Itens Vendidos: <span id="total-items-sold">0</span></strong></p> [cite: 312]
                <p><strong>Valor Total das Vendas: R$ <span id="total-sales-value">0.00</span></strong></p>
            </div>
            <div id="orders-tab" class="tab-content admin-section-inner">
                
                <h2>Pedidos</h2>
         
         <div id="orders-list"> [cite: 313]
                    <p>Nenhum pedido registrado ainda.</p>
                </div>
            </div>
            <div id="bank-tab" class="tab-content admin-section-inner">
                <h2>Configura√ß√µes do Banco</h2>
        
         <div class="bank-info"> [cite: 314]
                    <p><strong>Nome do Banco:</strong> <span id="displayBankName">N√£o Cadastrado</span></p>
                    <p><strong>Ag√™ncia:</strong> <span id="displayBankAgency">N√£o Cadastrada</span></p>
                    <p><strong>Conta:</strong> <span id="displayBankAccount">N√£o Cadastrada</span></p>
                    
 <p><strong>Chave Pix:</strong> <span id="displayPixKey">N√£o Cadastrada</span></p> [cite: 315]
                    <h3>Cadastrar/Atualizar Informa√ß√µes Banc√°rias</h3>
                    <input type="text" id="inputBankName" placeholder="Nome do Banco" /><br />
                    <input type="text" id="inputBankAgency" placeholder="Ag√™ncia" /><br />
                    <input type="text" 
 id="inputBankAccount" placeholder="Conta" /><br /> [cite: 316]
                    <input type="text" id="inputPixKey" placeholder="Chave Pix" /><br />
                    <button id="saveBankInfo">Salvar Informa√ß√µes Banc√°rias</button>
                </div>
            </div>
            <div id="withdraw-tab" class="tab-content admin-section-inner">
     
            <h2>Sacar Dinheiro</h2> [cite: 317]
                <div class="withdraw-info">
                    <p><strong>Saldo Dispon√≠vel: R$ <span id="availableBalance">0.00</span></strong></p>
                    <p>Insira o valor a sacar:</p>
                    <input type="number" id="withdrawAmount" 
 min="0" step="0.01" value="0.00" /> [cite: 318]
                    <button id="processWithdraw">Sacar</button>
                    <p id="withdrawMessage" style="color: green;
 margin-top: 10px;"></p> [cite: 319]
                </div>
            </div>
            <button id="backToOrder">Voltar aos Pedidos</button>
        </div>
    </div>
    <div id="scanner-tab" class="tab-content admin-section-inner">
        <h2>Escanear QR Code do Pedido</h2>
        <div id="camera" style="width: 100%;
 max-width: 400px;"></div> [cite: 320]
        <p id="scan-result" style="margin-top: 20px; font-weight: bold;"></p>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
    <script>
        // --- Vari√°veis Globais e Constantes ---
        const ADMIN_USERNAME = 'lpalmeira';
        const ADMIN_PASSWORD = '123';
        // Elementos da Se√ß√£o de Pedidos
        let produtos = []; // Ser√° preenchido dinamicamente do Firebase
        const produtosClienteDiv = document.getElementById('produtos-cliente');

        const orderSection = document.getElementById('order-section');
        const formPedido = document.getElementById('formPedido');
        const resumoDiv = document.getElementById('resumoPedido');
        const itensResumoDiv = document.getElementById('itensResumo');
        const totalResumoSpan = document.getElementById('totalResumo');
 
        const btnAvancarPagamento = document.getElementById('btnAvancarPagamento'); [cite: 322]
        const btnVoltarInicioResumo = document.getElementById('btnVoltarInicioResumo');
 const telaPagamento = document.getElementById('telaPagamento'); [cite: 323]
        const btnGerarQRCode = document.getElementById('btnGerarQRCode');
        const btnVoltarResumo = document.getElementById('btnVoltarResumo');
        const areaQRCode = document.getElementById('areaQRCode');
        const qrCanvas = document.getElementById('qrCanvas');
 const numeroPedidoDisplay = document.getElementById('numeroPedidoDisplay'); [cite: 324]
        const btnNovoPedido = document.getElementById('btnNovoPedido');
        
        // CORRE√á√ÉO: Removendo o querySelectorAll duplicado e movendo para dentro do DOMContentLoaded
        let btnQtds;
 // Elementos da Se√ß√£o de Administra√ß√£o [cite: 325]
        const btnAdminArea = document.getElementById('btnAdminArea');
 const adminSection = document.getElementById('admin-section'); [cite: 326]
        const loginScreen = document.getElementById('login-screen');
        const adminPanel = document.getElementById('admin-panel');
        const loginForm = document.getElementById('login-form');
        const loginMessage = document.getElementById('login-message');
 const tabButtons = document.querySelectorAll('.tab-button'); [cite: 327]
        const tabContents = document.querySelectorAll('.tab-content');
        const salesSummaryDiv = document.getElementById('sales-summary');
        const totalItemsSoldSpan = document.getElementById('total-items-sold');
        const totalSalesValueSpan = document.getElementById('total-sales-value');
 const ordersListDiv = document.getElementById('orders-list'); [cite: 328]
        const displayBankName = document.getElementById('displayBankName');
        const displayBankAgency = document.getElementById('displayBankAgency');
        const displayBankAccount = document.getElementById('displayBankAccount');
        const displayPixKey = document.getElementById('displayPixKey');
 const inputBankName = document.getElementById('inputBankName'); [cite: 329]
        const inputBankAgency = document.getElementById('inputBankAgency');
        const inputBankAccount = document.getElementById('inputBankAccount');
        const inputPixKey = document.getElementById('inputPixKey');
        const saveBankInfoBtn = document.getElementById('saveBankInfo');
 const availableBalanceSpan = document.getElementById('availableBalance'); [cite: 330]
        const withdrawAmountInput = document.getElementById('withdrawAmount');
        const processWithdrawBtn = document.getElementById('processWithdraw');
        const withdrawMessage = document.getElementById('withdrawMessage');
        const backToOrderBtn = document.getElementById('backToOrder');
 // Dados persistentes (usando localStorage) [cite: 331]
        let numeroPedido = 1;
        const pedidoLS = localStorage.getItem('ultimoNumeroPedido');
 if (pedidoLS) numeroPedido = parseInt(pedidoLS) + 1; [cite: 332]
        let allOrders = [];
 function carregarPedidosDoFirebase() { [cite: 333]
  db.ref('pedidos').once('value').then(snapshot => {
    const data = snapshot.val();
    if (data) {
      allOrders = Object.values(data);
    } else {
      allOrders = [];
    }
    updateAdminPanel(); // atualiza o painel com os dados carregados
  });
 } [cite: 334]
        let bankInfo = JSON.parse(localStorage.getItem('bankInfo')) || {};
        let accumulatedBalance = parseFloat(localStorage.getItem('accumulatedBalance')) || 0;
 // --- Fun√ß√µes de Visibilidade das Se√ß√µes --- [cite: 335]
        function showOrderSection() {
            orderSection.style.display = 'block';
 adminSection.style.display = 'none'; [cite: 336]
            localStorage.setItem('isAdmin', 'false'); // Sair do modo admin
        }
        function showAdminSection() {
            orderSection.style.display = 'none';
 adminSection.style.display = 'block'; [cite: 337]
            loginScreen.style.display = 'block'; // Sempre volta para a tela de login ao acessar Admin
            adminPanel.style.display = 'none';
 loginForm.reset(); // Limpa o formul√°rio de login [cite: 338]
            loginMessage.textContent = '';
 // Limpa mensagens de login [cite: 339]
            // Nao chamar updateAdminPanel() aqui, ele sera chamado apos o login
        }

        function checkAdminLoginStatus() {
            if (localStorage.getItem('isAdmin') === 'true') {
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'block';
                showAdminSectionContent(); // Carrega o conte√∫do do painel admin
            } else {
                showOrderSection();
            }
        }

        function showAdminSectionContent() {
            updateAdminPanel();
            const activeTab = document.querySelector('.tab-button.active');
            if (activeTab) {
                document.getElementById(`${activeTab.dataset.tab}-tab`).classList.add('active');
                if (activeTab.dataset.tab === 'produtos') {
                    carregarProdutos();
                }
                if (activeTab.dataset.tab === 'scanner') {
                    iniciarScanner();
                }
            }
        }

        // --- L√≥gica da P√°gina de Pedidos ---

        function renderProdutosCliente() {
            produtosClienteDiv.innerHTML = '';
            produtos.forEach(p => {
                const produtoDiv = document.createElement('div');
                produtoDiv.classList.add('produto');
                produtoDiv.innerHTML = `
                    <label for="${p.id}">${p.nome} - R$ ${parseFloat(p.preco).toFixed(2)}</label>
                    <div class="qtd-container">
                        <button type="button" class="btnQtd" data-target="${p.id}">-</button>
                        <input type="number" id="${p.id}" min="0" value="0" />
                        <button type="button" class="btnQtd" data-target="${p.id}">+</button>
                    </div>
                `;
                produtosClienteDiv.appendChild(produtoDiv);
            });
            setupQuantityButtons();
        }

        function setupQuantityButtons() {
            btnQtds = document.querySelectorAll('.btnQtd');
            btnQtds.forEach(btn => {
                btn.removeEventListener('click', handleQuantityChange); // Previne m√∫ltiplos event listeners
                btn.addEventListener('click', handleQuantityChange);
            });
        }

        function handleQuantityChange(event) {
            const btn = event.target;
            const inputId = btn.dataset.target;
            const input = document.getElementById(inputId);
            let val = parseInt(input.value) || 0;
            if (btn.textContent === '+') {
                val++;
            } else {
                val = val > 0 ? val - 1 : 0;
            }
            input.value = val;
        }


        // Ao submeter o formul√°rio, mostrar resumo
        formPedido.addEventListener('submit', e => {
            e.preventDefault();
            const itensSelecionados 
 = []; [cite: 340]
            let total = 0;
            for (const p of produtos) {
                const qtd = parseInt(document.getElementById(p.id).value) || 0;
                if (qtd > 0) {
                    const subtotal = qtd * p.preco;
 
                    total += subtotal; [cite: 341]
                    itensSelecionados.push({
                        nome: p.nome,
                        qtd,
          
               preco: p.preco, [cite: 342]
                        subtotal
                    });
                }
            }
            if 
 (itensSelecionados.length === 0) { [cite: 343]
                alert('Selecione ao menos um item para prosseguir.');
                return;
            }
            itensResumoDiv.innerHTML = '';
 itensSelecionados.forEach(item => { [cite: 344]
                const p = document.createElement('p');
                p.textContent = `${item.qtd} x ${item.nome} = R$ ${item.subtotal.toFixed(2)}`;
                itensResumoDiv.appendChild(p);
            });
 totalResumoSpan.textContent = total.toFixed(2); [cite: 345]
            formPedido.style.display = 'none';
            resumoDiv.style.display = 'block';
            telaPagamento.style.display = 'none';
            areaQRCode.style.display = 'none';
        });
 btnAvancarPagamento.addEventListener('click', () => { [cite: 346]
            resumoDiv.style.display = 'none';
            telaPagamento.style.display = 'block';
            areaQRCode.style.display = 'none';
        });
 btnVoltarInicioResumo.addEventListener('click', () => { [cite: 347]
            resumoDiv.style.display = 'none';
            formPedido.style.display = 'block';
        });
 btnVoltarResumo.addEventListener('click', () => { [cite: 348]
            telaPagamento.style.display = 'none';
            resumoDiv.style.display = 'block';
        });
 btnGerarQRCode.addEventListener('click', () => { [cite: 349]
    const pagamentoSelecionado = document.querySelector('input[name="pagamento"]:checked');
    if (!pagamentoSelecionado) {
        alert('Selecione uma forma de pagamento.');
        return;
    }
    const metodo = pagamentoSelecionado.value;
    const currentItemsSelected = [];
    let currentTotal = 0;
    for (const p of produtos) {
        const qtd = parseInt(document.getElementById(p.id).value) || 0;
        if (qtd > 0) {
     
        const subtotal = qtd * p.preco; [cite: 350]
            currentTotal += subtotal;
            currentItemsSelected.push({
                nome: p.nome,
                qtd,
                preco: p.preco,
            
     subtotal [cite: 351]
            });
        }
    }
    const orderData = {
        numeroPedido: numeroPedido,
        metodoPagamento: metodo,
        data: new Date().toISOString(),
        items: currentItemsSelected,
        total: currentTotal,
        entregue: false
    };
    db.ref('pedidos/' + 
 numeroPedido).set(orderData); [cite: 352]
    allOrders.push(orderData);
    accumulatedBalance += currentTotal;
    db.ref('saldo').set(accumulatedBalance);
    if (metodo === 'pix') {
        const bankInfoStored = JSON.parse(localStorage.getItem('bankInfo')) ||
 {}; [cite: 353]
        if (bankInfoStored.pixKey) {
            const pixQrString = `pix|${bankInfoStored.pixKey}|${currentTotal.toFixed(2)}|${numeroPedido}`;
 QRCode.toCanvas(qrCanvas, pixQrString, { width: 250 }, function (error) { [cite: 354]
                if (error) console.error(error);
                else {
                    numeroPedidoDisplay.textContent = `N√∫mero do pedido: ${numeroPedido}`;
                    telaPagamento.style.display = 'none';
          
                    areaQRCode.style.display = 'block'; [cite: 355]
                    alert(`Para pagar com Pix, use a chave: ${bankInfoStored.pixKey} com o valor de R$ ${currentTotal.toFixed(2)}`);
                }
            });
 } [cite: 356]
        } else {
            alert('Para pagamento com Pix, o administrador precisa cadastrar a Chave Pix nas configura√ß√µes do Banco.');
 return; [cite: 357]
        }
    } else {
        const qrString = `pagamento|${metodo}|${currentTotal.toFixed(2)}|${numeroPedido}`;
 QRCode.toCanvas(qrCanvas, qrString, { width: 250 }, function (error) { [cite: 358]
            if (error) console.error(error);
            else {
                numeroPedidoDisplay.textContent = `N√∫mero do pedido: ${numeroPedido}`;
                telaPagamento.style.display = 'none';
                areaQRCode.style.display = 'block';
        
     } [cite: 359]
        });
    }
    numeroPedido++;
});
 btnNovoPedido.addEventListener('click', () => { [cite: 360]
            for (const p of produtos) {
                document.getElementById(p.id).value = 0;
            }
            areaQRCode.style.display = 'none';
            resumoDiv.style.display = 'none';
            telaPagamento.style.display = 'none';
        
     formPedido.style.display = 'block'; [cite: 361]
            const radios = document.querySelectorAll('input[name="pagamento"]');
            radios.forEach(r => (r.checked = false));
        });
 // --- L√≥gica do Painel de Administra√ß√£o --- [cite: 362]
        // Mostrar painel de admin ao clicar no bot√£o "Administrador"
        btnAdminArea.addEventListener('click', showAdminSection);
 // Voltar para a se√ß√£o de pedidos [cite: 363]
        document.getElementById('backToOrderLogin').addEventListener('click', showOrderSection);
        backToOrderBtn.addEventListener('click', showOrderSection); // Added this line

 // L√≥gica de Login [cite: 364]
        loginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
           if (username === ADMIN_USERNAME && password === ADMIN_PASSWORD) {
                localStorage.setItem('isAdmin', 'true'); //  üëà  ADICIONA ESSA LINHA [cite: 365]
                loginScreen.style.display = 'none';
                adminPanel.style.display = 'block';
                loginMessage.textContent = '';
                showAdminSectionContent(); // Atualiza o painel ap√≥s o login
            } else {
                loginMessage.textContent = 'Usu√°rio ou senha incorretos.';
            }
        });
 // L√≥gica de Troca de Abas [cite: 366]
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                button.classList.add('active');
                document.getElementById(`${button.dataset.tab}-tab`).classList.add('active');
  
                updateAdminPanel(); // Atualiza o conte√∫do da aba ao trocar [cite: 367]
                if (button.dataset.tab === 'produtos') {
                    carregarProdutos();
                }
                if (button.dataset.tab === 'scanner') {
                    iniciarScanner();
                }   
            });
        });
 // Persist√™ncia de Dados (usando localStorage) [cite: 368]
        function saveOrders() {
            localStorage.setItem('allOrders', JSON.stringify(allOrders));
 } [cite: 369]
        function saveBankInfo() {
            localStorage.setItem('bankInfo', JSON.stringify(bankInfo));
 updateBankInfoDisplay(); // Atualiza a exibi√ß√£o imediatamente [cite: 370]
        }
        function saveAccumulatedBalance() {
            localStorage.setItem('accumulatedBalance', accumulatedBalance.toFixed(2));
 availableBalanceSpan.textContent = accumulatedBalance.toFixed(2); // Atualiza a exibi√ß√£o imediatamente [cite: 371]
        }
        // Fun√ß√£o para Atualizar o Painel Administrativo
        function updateAdminPanel() {
            updateSummary();
 updateOrdersList(); [cite: 372]
            updateBankInfoDisplay();
            updateWithdrawSection();
        }
        // L√≥gica da Aba Resumo
        function updateSummary() {
            let totalItems = 0;
 let totalSales = 0; [cite: 373]
            salesSummaryDiv.innerHTML = ''; // Limpa o resumo anterior
            if (allOrders.length === 0) {
                salesSummaryDiv.innerHTML = '<p>Nenhuma venda registrada ainda.</p>';
 } [cite: 374]
            } else {
                const productSales = {};
 allOrders.forEach(order => { [cite: 375]
                    order.items.forEach(item => {
                        if (!productSales[item.nome]) {
                            productSales[item.nome] = { quantity: 0, value: 0 };
               
                          } [cite: 376]
                        productSales[item.nome].quantity += item.qtd;
                        productSales[item.nome].value += item.subtotal;
                        totalItems += item.qtd;
             
                        totalSales += item.subtotal; [cite: 377]
                    });
                });
 for (const productName in productSales) { [cite: 378]
                    const data = productSales[productName];
 const p = document.createElement('p'); [cite: 379]
                    p.textContent = `${productName}: ${data.quantity} unidades vendidas, Total: R$ ${data.value.toFixed(2)}`;
                    salesSummaryDiv.appendChild(p);
 } [cite: 380]
            }
            totalItemsSoldSpan.textContent = totalItems;
 totalSalesValueSpan.textContent = totalSales.toFixed(2); [cite: 381]
        }
        // L√≥gica da Aba Pedidos
        function updateOrdersList() {
            ordersListDiv.innerHTML = '';
 if (allOrders.length === 0) { [cite: 382]
                ordersListDiv.innerHTML = '<p>Nenhum pedido registrado ainda.</p>';
 return; [cite: 383]
            }
            allOrders.forEach(order => {
                const orderDiv = document.createElement('div');
                orderDiv.classList.add('order-item');
                orderDiv.innerHTML = `
                    <h3>Pedido #${order.numeroPedido}</h3>
           
                    <p><strong>M√©todo de Pagamento:</strong> ${order.metodoPagamento.toUpperCase()}</p> [cite: 384]
                    <p><strong>Data:</strong> ${new Date(order.data).toLocaleString()}</p>
                    <h4>Itens:</h4>
                    <ul>
                        ${order.items.map(item => 
 `<li>${item.qtd} x ${item.nome} = R$ ${item.subtotal.toFixed(2)}</li>`).join('')} [cite: 385]
                    </ul>
                    <p><strong>Total do Pedido: R$ ${order.total.toFixed(2)}</strong></p>
                    <button onclick="printOrder(${order.numeroPedido})">Imprimir NF</button>
                `;
             
                ordersListDiv.appendChild(orderDiv); [cite: 386]
            });
 } [cite: 387]
        function printOrder(orderNumber) {
            const orderToPrint = allOrders.find(order => order.numeroPedido === orderNumber);
 if (!orderToPrint) { [cite: 388]
                alert('Pedido n√£o encontrado para impress√£o.');
 return; [cite: 389]
            }
            let printContent = `
                <h2>Nota Fiscal - Pedido #${orderToPrint.numeroPedido}</h2>
                <p><strong>Data:</strong> ${new Date(orderToPrint.data).toLocaleString()}</p>
                <p><strong>M√©todo de Pagamento:</strong> ${orderToPrint.metodoPagamento.toUpperCase()}</p>
                <hr>
           
                <h3>Itens:</h3> [cite: 390]
                <ul>
                    ${orderToPrint.items.map(item => `<li>${item.qtd} x ${item.nome} - R$ ${item.subtotal.toFixed(2)}</li>`).join('')}
                </ul>
                <hr>
                <p><strong>Total: R$ ${orderToPrint.total.toFixed(2)}</strong></p>
  
                <p>Obrigado pela prefer√™ncia!</p> [cite: 391]
            `;
 const printWindow = window.open('', '', 'height=600,width=800'); [cite: 392]
            printWindow.document.write('<html><head><title>Nota Fiscal</title>');
            printWindow.document.write('<style>body{font-family: Arial, sans-serif;}</style>');
            printWindow.document.write('</head><body>');
            printWindow.document.write(printContent);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }
const listaProdutosUL = document.getElementById('listaProdutos');
 const btnAdicionarProduto = document.getElementById('btnAdicionarProduto'); [cite: 393]
const inputProdutoNome = document.getElementById('novoProdutoNome');
const inputProdutoPreco = document.getElementById('novoProdutoPreco');
 // Carrega os produtos cadastrados [cite: 394]
function carregarProdutos() {
  db.ref('produtos').once('value').then(snapshot => {
    const firebaseProdutos = snapshot.val() || {};
    listaProdutosUL.innerHTML = '';
    produtos = []; // Limpa a lista de produtos global
    for (const id in firebaseProdutos) {
        const produto = firebaseProdutos[id];
        produto.id = id; // Adiciona o ID do Firebase ao objeto produto
        produtos.push(produto); // Adiciona ao array global
        const li = document.createElement('li');
        li.innerHTML = `
            ${produto.nome} - R$ ${parseFloat(produto.preco).toFixed(2)}
            <button onclick="excluirProduto('${id}')">Excluir</button>
        `;
        listaProdutosUL.appendChild(li);
    }
    renderProdutosCliente(); // Atualiza a exibi√ß√£o dos produtos no lado do cliente
  });
}
// Adiciona novo produto
btnAdicionarProduto.addEventListener('click', () => {
  const nome = inputProdutoNome.value.trim();
  const preco = parseFloat(inputProdutoPreco.value);
  if (!nome || isNaN(preco)) {
    alert('Preencha corretamente nome e pre√ßo.');
    return;
  }
  const novoRef = db.ref('produtos').push();
  novoRef.set({ nome, preco }).then(() => {
    inputProdutoNome.value = '';
    inputProdutoPreco.value = '';
    carregarProdutos(); // Recarrega para incluir o novo produto
  });
});
 // Exclui produto [cite: 396]
function excluirProduto(id) {
  if (confirm('Deseja excluir este produto?')) {
    db.ref('produtos/' + id).remove().then(carregarProdutos);
 } [cite: 397]
}
        
        // L√≥gica da Aba Banco
        function updateBankInfoDisplay() {
            displayBankName.textContent = bankInfo.bankName ||
 'N√£o Cadastrado'; [cite: 398]
            displayBankAgency.textContent = bankInfo.bankAgency || 'N√£o Cadastrada';
            displayBankAccount.textContent = bankInfo.bankAccount || 'N√£o Cadastrada';
            displayPixKey.textContent = bankInfo.pixKey || 'N√£o Cadastrada';
 inputBankName.value = bankInfo.bankName || ''; [cite: 399]
            inputBankAgency.value = bankInfo.bankAgency || '';
            inputBankAccount.value = bankInfo.bankAccount || '';
            inputPixKey.value = bankInfo.pixKey || '';
 } [cite: 400]
        saveBankInfoBtn.addEventListener('click', () => {
            bankInfo.bankName = inputBankName.value.trim();
            bankInfo.bankAgency = inputBankAgency.value.trim();
            bankInfo.bankAccount = inputBankAccount.value.trim();
            bankInfo.pixKey = inputPixKey.value.trim();
            saveBankInfo(); // Salva e atualiza a exibi√ß√£o
            alert('Informa√ß√µes banc√°rias salvas 
 com sucesso!'); [cite: 401]
        });
 // L√≥gica da Aba Sacar [cite: 402]
        function updateWithdrawSection() {
            availableBalanceSpan.textContent = accumulatedBalance.toFixed(2);
 withdrawMessage.textContent = ''; // Limpa mensagens anteriores [cite: 403]
            withdrawAmountInput.setAttribute('max', accumulatedBalance.toFixed(2));
 } [cite: 404]
        processWithdrawBtn.addEventListener('click', () => {
            const withdrawAmount = parseFloat(withdrawAmountInput.value);
            if (!bankInfo.bankName || !bankInfo.bankAccount) {
                withdrawMessage.textContent = 'Erro: Por favor, cadastre suas informa√ß√µes banc√°rias na aba "Banco" antes de sacar.';
                withdrawMessage.style.color = 'red';
          
                return; [cite: 405]
            }
            if (isNaN(withdrawAmount) || withdrawAmount <= 0) {
                withdrawMessage.textContent = 'Por favor, insira um valor v√°lido para saque.';
                withdrawMessage.style.color = 'red';
                return;
     
                } [cite: 406]
            if (withdrawAmount > accumulatedBalance) {
                withdrawMessage.textContent = `Voc√™ n√£o tem saldo suficiente. Saldo dispon√≠vel: R$ ${accumulatedBalance.toFixed(2)}`;
                withdrawMessage.style.color = 'red';
                return;
            }
     
            accumulatedBalance -= withdrawAmount; [cite: 407]
            saveAccumulatedBalance();
 // Salva e atualiza o saldo [cite: 408]
            withdrawMessage.textContent = `Saque de R$ ${withdrawAmount.toFixed(2)} realizado com sucesso para a conta ${bankInfo.bankAccount}.`;
 withdrawMessage.style.color = 'green'; [cite: 409]
            withdrawAmountInput.value = '0.00'; // Reseta o campo de valor
        });
 // --- Carregamento Inicial e Event Listeners --- [cite: 410]

        function initializeDefaultProducts() {
            const defaultProducts = [
                { id: 'qtdEspeto', nome: 'Espeto de Frango', preco: 5.0 },
                { id: 'qtdSuco', nome: 'Suco', preco: 4.0 },
                { id: 'qtdAgua', nome: '√Ågua', preco: 3.0 }
            ];

            defaultProducts.forEach(product => {
                db.ref('produtos').orderByChild('nome').equalTo(product.nome).once('value', snapshot => {
                    if (!snapshot.exists()) {
                        db.ref('produtos').push(product);
                    }
                });
            });
        }


       document.addEventListener('DOMContentLoaded', () => {
        initializeDefaultProducts(); // Garante que os produtos padr√£o estejam no Firebase
        carregarProdutos(); // Carrega os produtos do Firebase e atualiza a UI do cliente
        carregarPedidosDoFirebase(); // <-- adiciona essa linha aqui
        checkAdminLoginStatus(); // Verifica o status de login do admin

        // Os bot√µes de quantidade agora s√£o configurados dentro de renderProdutosCliente()
        // para garantir que eles sejam configurados ap√≥s a cria√ß√£o dos elementos.
        });
 </script>
    <script src="https://unpkg.com/html5-qrcode"></script>
<script>
let html5QrCode;
function iniciarScanner() {
  const scannerDiv = document.getElementById("camera");
  document.getElementById("scan-result").textContent = "";
 if (html5QrCode) { [cite: 415]
    html5QrCode.stop().then(() => {
      scannerDiv.innerHTML = "";
      start();
    });
 } else { [cite: 416]
    start();
  }
  function start() {
    html5QrCode = new Html5Qrcode("camera");
 html5QrCode.start( [cite: 417]
      { facingMode: "environment" },
      { fps: 10, qrbox: 250 },
      qrCodeMessage => {
        try {
          const partes = qrCodeMessage.split('|');
const numeroPedido = partes[3]; // o n√∫mero do pedido est√° na 4¬™ posi√ß√£o
const pedido = allOrders.find(p => p.numeroPedido == numeroPedido);
          if (pedido && !pedido.entregue) {
            pedido.entregue = true;
   
            saveOrders(); [cite: 418]
            document.getElementById("scan-result").textContent = ` ‚úÖ  Pedido #${pedido.numeroPedido} marcado como ENTREGUE.`;
          } else if (pedido && pedido.entregue) {
            document.getElementById("scan-result").textContent = ` ‚ö†Ô∏è  Pedido #${pedido.numeroPedido} j√° foi entregue.`;
          } else {
            document.getElementById("scan-result").textContent = " ‚ùå  Pedido n √£ o 
 encontrado."; [cite: 419]
          }
          html5QrCode.stop().then(() => scannerDiv.innerHTML = "");
        } catch (e) {
          document.getElementById("scan-result").textContent = "QR inv√°lido.";
 } [cite: 420]
      },
      err => {}
    );
 } [cite: 421]
}
// Quando clicar na aba "QRCODE", iniciar o scanner
document.querySelectorAll('.tab-button').forEach(button => {
  button.addEventListener('click', () => {
    if (button.dataset.tab === 'scanner') iniciarScanner();
  });
});
 </script>
</body>
</html>
